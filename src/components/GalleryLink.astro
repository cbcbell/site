---
import type { ImageMetadata } from "astro"
import { Image } from "astro:assets"

type Props = {
  href: string
  title: string
  image?: ImageMetadata
  coverSlug?: string
  alt?: string
}

const coverImages = import.meta.glob<{ default: ImageMetadata }>(
  "../assets/sync/gallery-covers/*.{jpg,jpeg,png}",
  { eager: true },
)

const { href, title, image, coverSlug, alt } = Astro.props as Props
const cover =
  image ??
  (coverSlug
    ? (coverImages[`../assets/sync/gallery-covers/${coverSlug}.jpg`]?.default ??
      coverImages[`../assets/sync/gallery-covers/${coverSlug}.jpeg`]?.default ??
      coverImages[`../assets/sync/gallery-covers/${coverSlug}.png`]?.default)
    : undefined)
---

<a href={href} class="group block">
  <div
    class="flex flex-col gap-4 transition hover:opacity-90 focus-visible:opacity-90"
  >
    <div class="aspect-2/1 w-full bg-neutral-200 md:aspect-2/3">
      {
        cover ? (
          <Image
            src={cover}
            alt={alt ?? "Christopher Campbell painting"}
            class="h-full w-full object-cover"
            sizes="(min-width: 1024px) 25vw, (min-width: 768px) 30vw, 100vw"
            loading="lazy"
          />
        ) : (
          <div class="flex h-full items-center justify-center text-sm text-neutral-500">
            Image coming soon
          </div>
        )
      }
    </div>
    <div class="flex items-end justify-between gap-3 text-lg md:text-xl">
      <span>{title}</span>
      <span
        aria-hidden
        class="text-neutral-500 transition duration-150 ease-out group-hover:translate-x-0.5 group-focus-visible:translate-x-0.5"
      >
        â†’
      </span>
    </div>
  </div>
</a>
