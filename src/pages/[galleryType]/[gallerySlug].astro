---
import { getCollection } from "astro:content"
// import { getImage } from "astro:assets"
import Layout from "~/layouts/Layout.astro"
import Header from "~/components/Header.astro"
import Gallery from "~/components/Gallery.astro"

export async function getStaticPaths() {
  const entries = await getCollection("galleries")
  return entries.map((entry) => ({
    params: {
      galleryType: entry.data.type,
      gallerySlug: entry.data.typeSlug || entry.slug,
    },
  }))
}

const { galleryType, gallerySlug } = Astro.params
const entries = await getCollection("galleries")
const entry = entries.find(
  (item) =>
    item.data.type === galleryType &&
    (item.data.typeSlug === gallerySlug || item.slug === gallerySlug),
)

if (!entry) {
  return Astro.redirect("/works")
}

const { title, newsletterUrl } = entry.data
const cover = entry.data.cover
// const coverUrl = cover ? getImage({ src: cover, format: "jpg" }) : undefined
const galleryFolder =
  entry.id?.replace(/^galleries\//, "").replace(/\.[^.]+$/, "") ||
  entry.slug ||
  gallerySlug
---

<Layout title={`${title} â€” Christopher Campbell`}>
  <Header title={title}>
    {
      newsletterUrl && (
        <a
          class="border-box border border-black px-4 py-2 text-sm transition hover:bg-black hover:text-white focus-visible:bg-black focus-visible:text-white"
          href={newsletterUrl}
          target="_blank"
          rel="noreferrer"
        >
          Read about the series
          <span class="-mr-1 inline-flex align-text-top">
            <svg fill="currentColor" viewBox="0 0 16 16" width="16" height="16">
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M6.75011 4H6.00011V5.5H6.75011H9.43945L5.46978 9.46967L4.93945 10L6.00011 11.0607L6.53044 10.5303L10.499 6.56182V9.25V10H11.999V9.25V5C11.999 4.44772 11.5512 4 10.999 4H6.75011Z"
              />
            </svg>
          </span>
        </a>
      )
    }
  </Header>

  <Gallery galleryFolder={galleryFolder} title={title} cover={cover} />
</Layout>
