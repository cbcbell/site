---
import { getCollection } from "astro:content"
import Layout from "~/layouts/Layout.astro"
import Header from "~/components/Header.astro"
import GalleryLink from "~/components/GalleryLink.astro"

export async function getStaticPaths() {
  return ["works", "series", "process"].map((galleryType) => ({
    params: { galleryType },
  }))
}

const { galleryType } = Astro.params
const galleries = (await getCollection("galleries")).filter(
  (entry) => entry.data.type === galleryType,
)

// Sort by explicit order, then title as a fallback
galleries.sort((a, b) => {
  const orderA = a.data.order ?? Number.POSITIVE_INFINITY
  const orderB = b.data.order ?? Number.POSITIVE_INFINITY
  if (orderA !== orderB) return orderA - orderB
  return a.data.title.localeCompare(b.data.title)
})
---

<Layout
  title={`${
    galleryType.charAt(0).toUpperCase() + galleryType.slice(1)
  } â€” Christopher Campbell`}
>
  <Header title={galleryType.charAt(0).toUpperCase() + galleryType.slice(1)} />

  <section class="grid gap-6 md:grid-cols-3 lg:gap-12">
    {
      galleries.map((entry) => {
        const slug = entry.data.typeSlug || entry.slug
        return (
          <GalleryLink
            href={`/${galleryType}/${slug}`}
            title={entry.data.title}
            coverSlug={entry.data.coverSlug}
            alt={entry.data.title}
          />
        )
      })
    }
  </section>
</Layout>
